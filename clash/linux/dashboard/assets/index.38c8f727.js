import{R as e,c as w,f as Ke,r as u,a as be,E as $e,b as Qe,d as G,e as we,u as me,g as ye,h as j,i as Re,j as ve,k as X,l as Ie,m as et,n as pe,o as tt,p as Ee,q as nt,s as ne,t as ot,v as at,w as rt,x as st,y as it,z as lt,A as ct,B as dt,C as ut,D as mt,F as pt,G as ft,H as xt,N as ht,O as gt,I as bt,J as de,K as wt,L as yt,M as vt}from"./vendor.520caf17.js";const Et=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}};Et();function q(){return navigator.userAgent==="ClashX Runtime"}let C=null;class kt{constructor(t){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(o=>{this.instance=o,t()})}initBridge(t){if(!q())return t==null?void 0:t(null);if(window.WebViewJavascriptBridge!=null)return t(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];const o=document.createElement("iframe");o.style.display="none",o.src="https://__bridge_loaded__",document.documentElement.appendChild(o),setTimeout(()=>document.documentElement.removeChild(o),0)}async callHandler(t,o){return await new Promise(a=>{var r;(r=this.instance)==null||r.callHandler(t,o,a)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(t){return await this.callHandler("setPasteboard",t)}async writeConfigWithString(t){return await this.callHandler("writeConfigWithString",t)}async setSystemProxy(t){return await this.callHandler("setSystemProxy",t)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(t){return await this.callHandler("speedTest",t)}async setStartAtLogin(t){return await this.callHandler("setStartAtLogin",t)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function Ct(n){if(C!=null){n();return}C=new kt(n)}function _(n){const{title:t,children:o,className:a,style:r}=n;return e.createElement("header",{className:w("header",a),style:r},e.createElement("h1",{className:"md:text-xl"},t),e.createElement("div",{className:"flex flex-auto items-center justify-end"},o))}function R(n){const{type:t,size:o=14,className:a,style:r}=n,s=w("clash-iconfont",`icon-${t}`,a),i={fontSize:o,...r},l={...n,className:s,style:i};return e.createElement("i",{...l})}function M(){}function Nt(n,t){const o=[],a=[];for(const r of n)t(r)?o.push(r):a.push(r);return[o,a]}function B(n){var a;const t=["B","KiB","MiB","GiB","TiB"],o=Math.floor(Math.log(n||1)/Math.log(1024));return`${Ke(n/Math.pow(1024,o),2).toFixed(2)} ${(a=t==null?void 0:t[o])!=null?a:""}`}function Te(n){return n.replace(/.*[/\\]/,"")}function ue(n){const{className:t,checked:o=!1,disabled:a=!1,onChange:r=M}=n,s=w("switch",{checked:o,disabled:a},t);function i(){a||r(!o)}return e.createElement("div",{className:s,onClick:i},e.createElement(R,{className:"switch-icon font-bold",type:"check",size:20}))}const H=u.exports.forwardRef((n,t)=>{const{className:o,style:a,children:r}=n;return e.createElement("div",{className:w("card",o),style:a,ref:t},r)});function Fe(n){const{options:t,value:o,onSelect:a}=n;return e.createElement("div",{className:"button-select"},t.map(r=>e.createElement("button",{value:r.value,key:r.value,className:w("button-select-options",{actived:o===r.value}),onClick:()=>a==null?void 0:a(r.value)},r.label)))}const Pt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs",levelLabel:"Log level"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",type:"Type",chains:"Chains",process:"Process",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Up",download:"Down",network:"Network",process:"Process",processPath:"Path",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},St={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",socks5ProxyPort:"Socks5 \u4EE3\u7406\u7AEF\u53E3",httpProxyPort:"HTTP \u4EE3\u7406\u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u4EE3\u7406\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7",levelLabel:"\u65E5\u5FD7\u7B49\u7EA7"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},columns:{host:"\u57DF\u540D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",sourceIP:"\u6765\u6E90 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",processPath:"\u8DEF\u5F84",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5305\u542B\u7B56\u7565\u7EC4\u7684\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},Be={en_US:Pt,zh_CN:St},zt=Object.keys(Be);function Dt(){for(const n of window.navigator.languages){if(n.includes("zh"))return"zh_CN";if(n.includes("us"))return"en_US"}return"en_US"}function ke(n){return u.exports.useMemo(()=>{function o(a,r){if(typeof a=="string")n(s=>{const i=a,l=r;s[i]=l});else if(typeof a=="function"){const s=a;n(i=>s(i))}else typeof a=="object"&&n(s=>be(s,i=>{const l=a;for(const c of Object.keys(l)){const h=c;i[h]=l[h]}}))}return o},[n])}class Me{constructor(t){this.EE=new $e,this.innerBuffer=[],this.url="",this.connection=null,this.config=Object.assign({bufferLength:0,retryInterval:5e3},t)}connectWebsocket(){const t=new URL(this.url);this.connection=new WebSocket(t.toString()),this.connection.addEventListener("message",o=>{const a=JSON.parse(o.data);this.EE.emit("data",[a]),this.config.bufferLength>0&&(this.innerBuffer.push(a),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),this.connection.addEventListener("error",o=>{var a;this.EE.emit("error",o),(a=this.connection)==null||a.close(),setTimeout(this.connectWebsocket,this.config.retryInterval)})}connect(t){var o;this.url===t&&this.connection||(this.url=t,(o=this.connection)==null||o.close(),this.connectWebsocket())}subscribe(t,o){this.EE.addListener(t,o)}unsubscribe(t,o){this.EE.removeListener(t,o)}buffer(){return this.innerBuffer.slice()}destory(){var t;this.EE.removeAllListeners(),(t=this.connection)==null||t.close(),this.connection=null}}class Ft{constructor(t,o){this.axiosClient=Qe.create({baseURL:t,headers:o?{Authorization:`Bearer ${o}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(t){return await this.axiosClient.patch("configs",t)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const t=await this.axiosClient.get("providers/proxies",{validateStatus(o){return o>=200&&o<300||o===404}});return t.status===404&&(t.data={providers:{}}),t}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(t){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(t)}`)}async updateRuleProvider(t){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(t)}`)}async healthCheckProvider(t){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(t)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(t){return await this.axiosClient.delete(`connections/${t}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(t,o){return await this.axiosClient.put(`proxies/${encodeURIComponent(t)}`,{name:o})}}const At=G(async()=>{if(!q())return null;const n=await C.getAPIInfo();return{hostname:n.host,port:n.port,secret:n.secret,protocol:"http:"}}),je=we("externalControllers",[]);function ee(){var h,p,f,m,x,y,v,F,S,z,N,D,J,U,W;const n=me(At),t=ye(),o=me(je);if(n!=null)return n;let a;{const O=document.querySelector('meta[name="external-controller"]');((h=O==null?void 0:O.content)==null?void 0:h.match(/^https?:/))!=null&&(a=new URL(O.content))}const r=new URLSearchParams(t.search),s=(x=(m=(f=r.get("host"))!=null?f:(p=o==null?void 0:o[0])==null?void 0:p.hostname)!=null?m:a==null?void 0:a.hostname)!=null?x:"127.0.0.1",i=(S=(F=(v=r.get("port"))!=null?v:(y=o==null?void 0:o[0])==null?void 0:y.port)!=null?F:a==null?void 0:a.port)!=null?S:"9090",l=(J=(D=(N=r.get("secret"))!=null?N:(z=o==null?void 0:o[0])==null?void 0:z.secret)!=null?D:a==null?void 0:a.username)!=null?J:"",c=((U=r.get("protocol"))!=null?U:s==="127.0.0.1")?"http:":(W=a==null?void 0:a.protocol)!=null?W:window.location.protocol;return{hostname:s,port:i,secret:l,protocol:c}}const Lt=G({key:"",instance:null});function $(){const{hostname:n,port:t,secret:o,protocol:a}=ee(),[r,s]=j(Lt),i=`${a}//${n}:${t}?secret=${o}`;if(r.key===i)return r.instance;const l=new Ft(`${a}//${n}:${t}`,o);return s({key:i,instance:l}),l}const Ce=G(!0),$t=we("language",void 0);function P(){const[n,t]=j($t),o=u.exports.useMemo(()=>n!=null?n:Dt(),[n]),a=u.exports.useCallback(function(r){function s(i){return tt(Be[o][r],i)}return{t:s}},[o]);return{lang:o,locales:zt,setLang:t,translation:a}}const He=G({version:"",premium:!1});function Ue(){const[n,t]=j(He),o=$(),a=ve(Ce);return X([o],async function(){const r=await Ie.fromPromise(o.getVersion(),s=>s);a(r.isOk()),t(r.isErr()?{version:"",premium:!1}:{version:r.value.data.version,premium:!!r.value.data.premium})}),n}function Oe(){const[{premium:n}]=j(He),t=$(),{data:o,mutate:a}=X(["/providers/rule",t,n],async()=>{if(!n)return[];const r=await t.getRuleProviders();return Object.keys(r.data.providers).map(s=>r.data.providers[s])});return{providers:o!=null?o:[],update:a}}const Rt=we("profile",{breakConnections:!1,logLevel:""});function re(){const[n,t]=j(Rt),o=u.exports.useCallback(a=>{t(be(n,a))},[n,t]);return{data:n,set:ke(o)}}const Ve=G([]);function Ye(){const[n,t]=j(Ve),o=$(),{data:a,mutate:r}=X(["/providers/proxy",o],async()=>{const s=await o.getProxyProviders();return Object.keys(s.data.providers).map(i=>s.data.providers[i]).filter(i=>i.name!=="default").filter(i=>i.vehicleType!=="Compatible")});return u.exports.useEffect(()=>{t(a!=null?a:[])},[a,t]),{providers:n,update:r}}function Ne(){const n=$(),{data:t,mutate:o}=X(["/config",n],async()=>{var s;const r=(await n.getConfig()).data;return{port:r.port,socksPort:r["socks-port"],mixedPort:(s=r["mixed-port"])!=null?s:0,redirPort:r["redir-port"],mode:r.mode.toLowerCase(),logLevel:r["log-level"],allowLan:r["allow-lan"]}});return{general:t!=null?t:{},update:o}}const _e=Re({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function se(){const[n,t]=j(_e),o=ke(t),a=$(),{mutate:r}=X(["/proxies",a],async()=>{const i=await a.getProxies(),l=i.data.proxies.GLOBAL;l.name="GLOBAL";const c=new Set(["Selector","URLTest","Fallback","LoadBalance"]),h=new Set(["DIRECT","REJECT","GLOBAL"]),p=l.all.filter(x=>!h.has(x)).map(x=>({...i.data.proxies[x],name:x})),[f,m]=Nt(p,x=>!c.has(x.type));o({proxies:f,groups:m,global:l})}),s=u.exports.useCallback((i,l)=>{o(c=>{i==="GLOBAL"&&(c.global.now=l);for(const h of c.groups)h.name===i&&(h.now=l)})},[o]);return{proxies:n.proxies,groups:n.groups,global:n.global,update:r,markProxySelected:s,set:o}}const It=G(n=>{const t=n(_e),o=n(Ve),a=new Map;for(const r of t.proxies)a.set(r.name,r);for(const r of o)for(const s of r.proxies)a.set(s.name,s);return a});function We(){const{data:n,mutate:t}=X("/clashx",async()=>{var r,s;if(!q())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const o=(r=await(C==null?void 0:C.getStartAtLogin()))!=null?r:!1,a=(s=await(C==null?void 0:C.isSystemProxySet()))!=null?s:!1;return{startAtLogin:o,systemProxy:a,isClashX:!0}});return{data:n,update:t}}const Tt=Re([]);function Bt(){const[n,t]=j(Tt),o=ke(t),a=$();async function r(){const s=await a.getRules();o(s.data.rules)}return{rules:n,update:r}}const Mt=G(new Me({bufferLength:200}));function Ge(){const n=ee(),{general:t}=Ne(),{data:{logLevel:o}}=re(),a=me(Mt),r=o||t.logLevel,s=et(`${n.protocol}//${n.hostname}:${n.port}/logs?level=${r}&secret=${encodeURIComponent(n.secret)}`),i=pe(n);return u.exports.useEffect(()=>{if(r){const l=i.current,h=`${l.protocol==="http:"?"ws:":"wss:"}//${l.hostname}:${l.port}/logs?level=${r}&token=${encodeURIComponent(l.secret)}`;a.connect(h)}},[i,a,r,s]),a}function jt(){const n=ee(),t=u.exports.useRef(new Me({bufferLength:200})),a=`${n.protocol==="http:"?"ws:":"wss:"}//${n.hostname}:${n.port}/connections?token=${encodeURIComponent(n.secret)}`;return u.exports.useEffect(()=>{t.current.connect(a)},[a]),t.current}function Ht(n){const{className:t,data:o,onClick:a,select:r,canClick:s,errSet:i,rowHeight:l}=n,{translation:c}=P(),{t:h}=c("Proxies"),[p,f]=u.exports.useState(!1),[m,x]=u.exports.useState(!1),y=u.exports.useRef(null);u.exports.useLayoutEffect(()=>{var N,D;x(((D=(N=y==null?void 0:y.current)==null?void 0:N.offsetHeight)!=null?D:0)>30)},[]);const v=p?"auto":l,F=s?a:M;function S(){f(!p)}const z=o.map(N=>{const D=w({"tags-selected":r===N,"cursor-pointer":s,error:i==null?void 0:i.has(N)});return e.createElement("li",{className:D,key:N,onClick:()=>F(N)},N)});return e.createElement("div",{className:w("flex items-start overflow-y-hidden",t),style:{height:v}},e.createElement("ul",{ref:y,className:w("tags",{expand:p})},z),m&&e.createElement("span",{className:"h-7 px-5 select-none cursor-pointer leading-7",onClick:S},h(p?"collapseText":"expandText")))}function Z(n){const{className:t,style:o,value:a="",align:r="center",inside:s=!1,autoFocus:i=!1,type:l="text",disabled:c=!1,onChange:h=M,onBlur:p=M,onEnter:f=M}=n,m=w("input",`text-${r}`,{"focus:shadow-none":s},t);function x(y){y.code==="Enter"&&f(y)}return e.createElement("input",{disabled:c,className:m,style:o,value:a,autoFocus:i,type:l,onChange:y=>h(y.target.value,y),onBlur:p,onKeyDown:x})}function Ut(n){const{value:t,options:o,onSelect:a,className:r,style:s}=n,i=u.exports.useRef(document.createElement("div")),l=u.exports.useRef(null),[c,h]=u.exports.useState(!1),[p,f]=u.exports.useState({});u.exports.useLayoutEffect(()=>{const v=l.current.getBoundingClientRect();f({top:Math.floor(v.top+v.height)+6,left:Math.floor(v.left)-10})},[]),u.exports.useLayoutEffect(()=>{const v=i.current;return document.body.appendChild(v),()=>{document.body.removeChild(v)}},[]);function m(){h(!c)}const x=u.exports.useMemo(()=>o.find(v=>v.value===t),[t,o]),y=e.createElement("div",{className:w("select-list",{"select-list-show":c}),style:p},e.createElement("ul",{className:"list"},o.map(v=>{var F;return e.createElement(Ot,{className:w({selected:v.value===t}),onClick:S=>{a==null||a(v.value,S),h(!1)},disabled:v.disabled,key:(F=v.key)!=null?F:v.value,value:v.value},v.label)})));return e.createElement(e.Fragment,null,e.createElement("div",{className:w("select",r),style:s,ref:l,onClick:m},x==null?void 0:x.label,e.createElement(R,{type:"triangle-down"})),Ee.exports.createPortal(y,i.current))}function Ot(n){const{className:t,style:o,disabled:a=!1,children:r,onClick:s=M}=n,i=w("option",{disabled:a},t);return e.createElement("li",{className:i,style:o,onClick:s},r)}function Xe(n){const{show:t=!0,title:o="Modal",size:a="small",footer:r=!0,onOk:s=M,onClose:i=M,bodyClassName:l,bodyStyle:c,className:h,style:p,children:f}=n,{translation:m}=P(),{t:x}=m("Modal"),y=u.exports.useRef(document.createElement("div")),v=u.exports.useRef(null);u.exports.useLayoutEffect(()=>{const z=y.current;return document.body.appendChild(z),()=>{document.body.removeChild(z)}},[]);function F(z){z.target===v.current&&i()}const S=e.createElement("div",{className:w("modal-mask",{"modal-show":t}),ref:v,onMouseDown:F},e.createElement("div",{className:w("modal",`modal-${a}`,h),style:p},e.createElement("div",{className:"modal-title"},o),e.createElement("div",{className:w("modal-body",l),style:c},f),r&&e.createElement("div",{className:"footer"},e.createElement(fe,{onClick:()=>i()},x("cancel")),e.createElement(fe,{type:"primary",onClick:()=>s()},x("ok")))));return Ee.exports.createPortal(S,y.current)}const Vt={success:"check",info:"info",warning:"info",error:"close"};function Yt(n){const{message:t="",type:o="info",inside:a=!1,children:r,className:s,style:i}=n,l=w("alert",`alert-${a?"note":"box"}-${o}`,s);return e.createElement("div",{className:l,style:i},e.createElement("span",{className:"alert-icon"},e.createElement(R,{type:Vt[o],size:26})),t?e.createElement("p",{className:"alert-message"},t):e.createElement("div",{className:"alert-message"},r))}function fe(n){const{type:t="normal",onClick:o=M,children:a,className:r,style:s,disiabled:i}=n,l=w("button",`button-${t}`,r,{"button-disabled":i});return e.createElement("button",{className:l,style:s,onClick:o,disabled:i},a)}function oe(n){const[t,o]=nt(n),a=u.exports.useMemo(()=>{function r(s,i){typeof s=="string"?o(l=>{const c=s,h=i;l[c]=h}):typeof s=="function"?o(s):typeof s=="object"&&o(l=>{const c=s;for(const h of Object.keys(c)){const p=h;l[p]=c[p]}})}return r},[o]);return[t,a]}function _t(n,t=0){if(n.length<2)throw new Error("List requires at least two elements");const[o,a]=u.exports.useState(t);function r(){a((o+1)%n.length)}return{current:u.exports.useMemo(()=>n[o],[n,o]),next:r}}function Pe(n=!1){const[t,o]=u.exports.useState(n);function a(){o(!1)}function r(){o(!0)}return{visible:t,hide:a,show:r}}function Je(n){const{className:t,checked:o=!1,onChange:a=M}=n,r=w("checkbox",{checked:o},t);function s(){a(!o)}return e.createElement("div",{className:r,onClick:s},e.createElement(R,{className:"checkbox-icon",type:"check",size:18}),e.createElement("div",null,n.children))}function ae(n){const{color:t,className:o,style:a}=n,r=w("tag",o),s={color:t,...a},i={...n,className:r,style:s};return e.createElement("span",{...i},n.children)}function Wt(n){const t=w("spinner",n.className);return e.createElement("div",{className:t},e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})))}function Ze(n){const t=w("loading","visible",n.className);return n.visible?e.createElement("div",{className:t},e.createElement(Wt,{className:n.spinnerClassName})):null}function Gt(n){var r,s,i;const t=u.exports.useRef(document.createElement("div"));u.exports.useLayoutEffect(()=>{const l=t.current;return document.body.appendChild(l),()=>{document.body.removeChild(l)}},[]);const o="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",a=e.createElement("div",{className:w(n.className,"absolute inset-0 pointer-events-none z-9999")},e.createElement(H,{className:w(o,n.bodyClassName,{"translate-x-0":n.visible}),style:{width:(r=n.width)!=null?r:400}},n.children));return Ee.exports.createPortal(a,(i=(s=n.containerRef)==null?void 0:s.current)!=null?i:t.current)}ne.extend(ot);function Se(n,t){const o=t==="en_US"?"en":"zh-cn";return ne(n).locale(o).from(ne())}function Xt(n){const{translation:t}=P(),o=u.exports.useMemo(()=>t("Connections").t,[t]),{className:a,style:r}=n,s=w("flex flex-wrap px-1",a);function i(l){var c;(c=n.onChange)==null||c.call(n,l)}return e.createElement("div",{className:s,style:r},e.createElement("div",{className:w("connections-devices-item pt-2 mb-2",{selected:n.selected===""}),onClick:()=>i("")},o("filter.all")),n.devices.map(l=>e.createElement("div",{key:l.label,className:w("connections-devices-item pt-2 mb-2",{selected:n.selected===l.label}),onClick:()=>i(l.label)},l.label," (",l.number,")")))}function Jt(n){var a,r,s,i,l,c,h,p,f,m,x,y,v;const{translation:t}=P(),o=u.exports.useMemo(()=>t("Connections").t,[t]);return e.createElement("div",{className:w(n.className,"text-sm flex flex-col overflow-y-auto")},e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.id")),e.createElement("span",{className:"font-mono"},n.connection.id)),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},o("info.network")),e.createElement("span",{className:"font-mono"},(a=n.connection.metadata)==null?void 0:a.network)),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},o("info.inbound")),e.createElement("span",{className:"font-mono"},(r=n.connection.metadata)==null?void 0:r.type))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.host")),e.createElement("span",{className:"font-mono flex-1 break-all"},(s=n.connection.metadata)!=null&&s.host?`${n.connection.metadata.host}:${(i=n.connection.metadata)==null?void 0:i.destinationPort}`:o("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.dstIP")),e.createElement("span",{className:"font-mono"},(l=n.connection.metadata)!=null&&l.destinationIP?`${n.connection.metadata.destinationIP}:${(c=n.connection.metadata)==null?void 0:c.destinationPort}`:o("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.srcIP")),e.createElement("span",{className:"font-mono"},`${(h=n.connection.metadata)==null?void 0:h.sourceIP}:${(p=n.connection.metadata)==null?void 0:p.sourcePort}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.process")),e.createElement("span",{className:"font-mono flex-1 break-all"},(f=n.connection.metadata)!=null&&f.processPath?`${Te(n.connection.metadata.processPath)}`:o("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.processPath")),e.createElement("span",{className:"font-mono flex-1 break-all"},(m=n.connection.metadata)!=null&&m.processPath?`${n.connection.metadata.processPath}`:o("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.rule")),e.createElement("span",{className:"font-mono"},n.connection.rule&&`${n.connection.rule}${n.connection.rulePayload&&` :: ${n.connection.rulePayload}`}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.chains")),e.createElement("span",{className:"font-mono flex-1 break-all"},(x=n.connection.chains)==null?void 0:x.slice().reverse().join(" / "))),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},o("info.upload")),e.createElement("span",{className:"font-mono"},B((y=n.connection.upload)!=null?y:0))),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},o("info.download")),e.createElement("span",{className:"font-mono"},B((v=n.connection.download)!=null?v:0)))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},o("info.status")),e.createElement("span",{className:"font-mono"},n.connection.completed?e.createElement("span",{className:"text-red"},o("info.closed")):e.createElement("span",{className:"text-green"},o("info.opening")))))}class Zt{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(t){var a;const o=t.reduce((r,s)=>r.set(s.id,s),new Map);for(const r of this.connections.keys())if(!o.has(r))if(!this.saveDisconnection)this.connections.delete(r);else{const s=this.connections.get(r);s!=null&&this.connections.set(r,be(s,i=>{i.completed=!0,i.uploadSpeed=0,i.downloadSpeed=0}))}for(const r of o.keys()){if(!this.connections.has(r)){this.connections.set(r,{...o.get(r),uploadSpeed:0,downloadSpeed:0});continue}const s=this.connections.get(r),i=o.get(r);(a=this.connections)==null||a.set(r,{...i,uploadSpeed:i.upload-s.upload,downloadSpeed:i.download-s.download})}}toggleSave(){var t,o;if(this.saveDisconnection){this.saveDisconnection=!1;for(const a of this.connections.keys())(o=(t=this.connections)==null?void 0:t.get(a))!=null&&o.completed&&this.connections.delete(a)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function qt(){const n=u.exports.useMemo(()=>new Zt,[]),t=u.exports.useRef(!0),[o,a]=u.exports.useState([]),[r,s]=u.exports.useState(!1),i=u.exports.useCallback(function(c){n.appendToSet(c),t.current&&a(n.getConnections()),t.current=!t.current},[n]),l=u.exports.useCallback(function(){const c=n.toggleSave();s(c),c||a(n.getConnections()),t.current=!0},[n]);return{connections:o,feed:i,toggleSave:l,save:r}}const b={Host:"host",Network:"network",Process:"process",Type:"type",Chains:"chains",Rule:"rule",Speed:"speed",Upload:"upload",Download:"download",SourceIP:"sourceIP",Time:"time"},Kt=new Set([b.Network,b.Type,b.Speed,b.Upload,b.Download,b.SourceIP,b.Time,b.Process]);function Qt(n,t){switch(!0){case(n===0&&t===0):return"-";case(n!==0&&t!==0):return`\u2191 ${B(n)}/s \u2193 ${B(t)}/s`;case n!==0:return`\u2191 ${B(n)}/s`;default:return`\u2193 ${B(t)}/s`}}const L=at().setRowType();function en(){const{translation:n,lang:t}=P(),o=u.exports.useMemo(()=>n("Connections").t,[n]),a=jt(),r=pe(a),s=$(),i=u.exports.useRef(null),[l,c]=oe({uploadTotal:0,downloadTotal:0}),{visible:h,show:p,hide:f}=Pe();function m(){s.closeAllConnections().finally(()=>f())}const{connections:x,feed:y,save:v,toggleSave:F}=qt(),S=u.exports.useMemo(()=>x.map(d=>({id:d.id,host:`${d.metadata.host||d.metadata.destinationIP}:${d.metadata.destinationPort}`,chains:d.chains.slice().reverse().join(" / "),rule:d.rulePayload?`${d.rule} :: ${d.rulePayload}`:d.rule,time:new Date(d.start).getTime(),upload:d.upload,download:d.download,sourceIP:d.metadata.sourceIP,type:d.metadata.type,network:d.metadata.network.toUpperCase(),process:d.metadata.processPath,speed:{upload:d.uploadSpeed,download:d.downloadSpeed},completed:!!d.completed,original:d})),[x]),z=u.exports.useMemo(()=>{const d=rt(x,"metadata.sourceIP");return Object.keys(d).map(k=>({label:k,number:d[k].length})).sort((k,g)=>k.label.localeCompare(g.label))},[x]),N=u.exports.useRef(null),D=st(N,{threshold:[1]}),J=u.exports.useMemo(()=>[L.createDataColumn(b.Host,{minSize:260,size:260,header:o(`columns.${b.Host}`)}),L.createDataColumn(b.Network,{minSize:80,size:80,header:o(`columns.${b.Network}`)}),L.createDataColumn(b.Type,{minSize:100,size:100,header:o(`columns.${b.Type}`)}),L.createDataColumn(b.Chains,{minSize:200,size:200,header:o(`columns.${b.Chains}`)}),L.createDataColumn(b.Rule,{minSize:140,size:140,header:o(`columns.${b.Rule}`)}),L.createDataColumn(b.Process,{minSize:100,size:100,header:o(`columns.${b.Process}`),cell:d=>d.getValue()?Te(d.getValue()):"-"}),L.createDataColumn(d=>[d.speed.upload,d.speed.download],{id:b.Speed,header:o(`columns.${b.Speed}`),minSize:200,size:200,sortDescFirst:!0,sortingFn(d,k){var Y,Q,ze,De;const g=(Q=(Y=d.original)==null?void 0:Y.speed)!=null?Q:{upload:0,download:0},T=(De=(ze=k.original)==null?void 0:ze.speed)!=null?De:{upload:0,download:0};return g.download===T.download?g.upload-T.upload:g.download-T.download},cell:d=>Qt(d.getValue()[0],d.getValue()[1])}),L.createDataColumn(b.Upload,{minSize:100,size:100,header:o(`columns.${b.Upload}`),cell:d=>B(d.getValue())}),L.createDataColumn(b.Download,{minSize:100,size:100,header:o(`columns.${b.Download}`),cell:d=>B(d.getValue())}),L.createDataColumn(b.SourceIP,{minSize:140,size:140,header:o(`columns.${b.SourceIP}`),filterFn:"equals"}),L.createDataColumn(b.Time,{minSize:120,size:120,header:o(`columns.${b.Time}`),cell:d=>Se(new Date(d.getValue()),t),sortingFn:(d,k)=>{var g,T,Y,Q;return((T=(g=k.original)==null?void 0:g.time)!=null?T:0)-((Q=(Y=d.original)==null?void 0:Y.time)!=null?Q:0)}})],[t,o]);u.exports.useLayoutEffect(()=>{function d(k){for(const g of k)c({uploadTotal:g.uploadTotal,downloadTotal:g.downloadTotal}),y(g.connections)}return a==null||a.subscribe("data",d),()=>{a==null||a.unsubscribe("data",d)}},[a,y,c]),it(()=>{var d;(d=r.current)==null||d.destory()});const U=lt(L,{data:S,columns:J,getCoreRowModel:ct(),getSortedRowModel:dt(),getFilteredRowModel:ut(),initialState:{sorting:[{id:b.Time,desc:!1}]},columnResizeMode:"onChange",enableColumnResizing:!0}),W=U.getHeaderGroups()[0],[O,ie]=u.exports.useState("");function le(d){ie(d),U.getColumn(b.SourceIP).setFilterValue(d||void 0)}const[I,A]=oe({visible:!1,selectedID:"",connection:{}});function ce(){A(d=>{d.connection.completed=!0}),s.closeConnection(I.selectedID)}const V=pe(I.connection);u.exports.useEffect(()=>{var k;const d=(k=S.find(g=>g.id===I.selectedID))==null?void 0:k.original;d?A(g=>{g.connection={...d},I.selectedID===V.current.id&&(g.connection.completed=V.current.completed)}):Object.keys(V.current).length!==0&&!V.current.completed&&A(g=>{g.connection.completed=!0})},[S,I.selectedID,V,A]);const K=u.exports.useMemo(()=>{var d;return((d=D==null?void 0:D.intersectionRatio)!=null?d:0)<1},[D]),te=W.headers.map((d,k)=>{const g=d.column,T=g.id;return e.createElement("th",{className:w("connections-th",{resizing:g.getIsResizing(),fixed:g.id===b.Host,shadow:K&&g.id===b.Host}),style:{width:d.getSize()},ref:g.id===b.Host?N:void 0,key:T},e.createElement("div",{onClick:g.getToggleSortingHandler()},d.renderHeader(),g.getIsSorted()!==!1?g.getIsSorted()==="desc"?" \u2193":" \u2191":null),k!==W.headers.length-1&&e.createElement("div",{onMouseDown:d.getResizeHandler(),onTouchStart:d.getResizeHandler(),className:"connections-resizer"}))}),E=U.getRowModel().rows.map(d=>{var k;return e.createElement("tr",{className:"cursor-default select-none",key:(k=d.original)==null?void 0:k.id,onClick:()=>{var g;return A({visible:!0,selectedID:(g=d.original)==null?void 0:g.id})}},d.getAllCells().map(g=>{var Y;const T=w("connections-block",{"text-center":Kt.has(g.column.id),completed:(Y=d.original)==null?void 0:Y.completed},{fixed:g.column.id===b.Host,shadow:K&&g.column.id===b.Host});return e.createElement("td",{className:T,style:{width:g.column.getSize()},key:g.column.id},g.renderCell())}))});return e.createElement("div",{className:"page !h-100vh"},e.createElement(_,{title:o("title")},e.createElement("span",{className:"cursor-default flex-1 connections-filter"},`(${o("total.text")}: ${o("total.upload")} ${B(l.uploadTotal)} ${o("total.download")} ${B(l.downloadTotal)})`),e.createElement(Je,{className:"connections-filter",checked:v,onChange:F},o("keepClosed")),e.createElement(R,{className:"connections-filter dangerous",onClick:p,type:"close-all",size:20})),z.length>1&&e.createElement(Xt,{devices:z,selected:O,onChange:le}),e.createElement(H,{ref:i,className:"connections-card relative"},e.createElement("div",{className:"overflow-auto min-h-full min-w-full"},e.createElement("table",null,e.createElement("thead",null,e.createElement("tr",{className:"connections-header"},te)),e.createElement("tbody",null,E)))),e.createElement(Xe,{title:o("closeAll.title"),show:h,onClose:f,onOk:m},o("closeAll.content")),e.createElement(Gt,{containerRef:i,bodyClassName:"flex flex-col",visible:I.visible,width:450},e.createElement("div",{className:"flex h-8 justify-between items-center"},e.createElement("span",{className:"font-bold pl-3"},o("info.title")),e.createElement(R,{type:"close",size:16,className:"cursor-pointer",onClick:()=>A("visible",!1)})),e.createElement(Jt,{className:"mt-3 px-5",connection:I.connection}),e.createElement("div",{className:"flex mt-3 pr-3 justify-end"},e.createElement(fe,{type:"danger",disiabled:I.connection.completed,onClick:()=>ce()},o("info.closeConnection")))))}function tn(){const{translation:n}=P(),{t}=n("Settings"),{hostname:o,port:a,secret:r}=ee(),[s,i]=j(Ce),[l,c]=oe({hostname:"",port:"",secret:""});u.exports.useEffect(()=>{c({hostname:o,port:a,secret:r})},[o,a,r,c]);const h=ve(je);function p(){const{hostname:f,port:m,secret:x}=l;h([{hostname:f,port:m,secret:x}])}return e.createElement(Xe,{show:!s,title:t("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>i(!0),onOk:p},e.createElement(Yt,{type:"info",inside:!0},e.createElement("p",null,t("externalControllerSetting.note"))),e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.host")),e.createElement(Z,{className:"flex-1 my-1 md:my-3",align:"left",inside:!0,value:l.hostname,onChange:f=>c("hostname",f),onEnter:p})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.port")),e.createElement(Z,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:l.port,onChange:f=>c("port",f),onEnter:p})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.secret")),e.createElement(Z,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:l.secret,onChange:f=>c("secret",f),onEnter:p})))}const nn=[{label:"Default",value:""},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warning"},{label:"Error",value:"error"},{label:"Silent",value:"silent"}],on=new Map([["debug","text-teal-500"],["info","text-sky-500"],["warning","text-pink-500"],["error","text-rose-500"]]);function an(){var p,f;const n=u.exports.useRef(null),t=u.exports.useRef([]),[o,a]=u.exports.useState([]),{translation:r}=P(),{data:{logLevel:s},set:i}=re(),{t:l}=r("Logs"),c=Ge(),h=u.exports.useRef((f=(p=n.current)==null?void 0:p.scrollHeight)!=null?f:0);return u.exports.useLayoutEffect(()=>{var x;const m=n.current;m!=null&&h.current===m.scrollTop+m.clientHeight&&(m.scrollTop=m.scrollHeight-m.clientHeight),h.current=(x=m==null?void 0:m.scrollHeight)!=null?x:0}),u.exports.useEffect(()=>{function m(x){t.current=t.current.slice().concat(x.map(y=>({...y,time:new Date}))),a(t.current)}return c!=null&&(c.subscribe("data",m),t.current=c.buffer(),a(t.current)),()=>c==null?void 0:c.unsubscribe("data",m)},[c]),e.createElement("div",{className:"page"},e.createElement(_,{title:l("title")},e.createElement("span",{className:"text-sm text-primary-darken mr-2"},l("levelLabel"),":"),e.createElement(Ut,{options:nn,value:mt(s),onSelect:m=>i(x=>{x.logLevel=m})})),e.createElement(H,{className:"flex flex-col flex-1 mt-2.5 md:mt-4"},e.createElement("ul",{className:"logs-panel",ref:n},o.map((m,x)=>e.createElement("li",{className:"leading-5 inline-block text-[11px]",key:x},e.createElement("span",{className:"mr-2 text-orange-400"},"[",ne(m.time).format("YYYY-MM-DD HH:mm:ss"),"]"),e.createElement("span",{className:on.get(m.type)},"[",m.type.toUpperCase(),"]"),e.createElement("span",null," ",m.payload))))))}var xe=(n=>(n.SPEED_NOTIFY="speed-notify",n))(xe||{});class rn{constructor(){this.EE=new $e}notifySpeedTest(){this.EE.emit("speed-notify")}subscribe(t,o){this.EE.addListener(t,o)}unsubscribe(t,o){this.EE.removeListener(t,o)}}var he=new rn;const Ae={"#909399":0,"#00c520":260,"#ff9a28":600,"#ff3e5e":1/0};function qe(n){const{config:t,className:o}=n,{set:a}=se(),r=$(),s=u.exports.useCallback(async f=>{var x;if(q())return(x=await(C==null?void 0:C.getProxyDelay(f)))!=null?x:0;const{data:{delay:m}}=await r.getProxyDelay(f);return m},[r]),i=u.exports.useCallback(async function(){const f=await Ie.fromPromise(s(t.name),x=>x),m=f.isErr()?0:f.value;a(x=>{const y=x.proxies.find(v=>v.name===t.name);y!=null&&y.history.push({time:Date.now().toString(),delay:m})})},[t.name,s,a]),l=u.exports.useMemo(()=>{var f;return(f=t.history)!=null&&f.length?t.history.slice(-1)[0].delay:0},[t]);u.exports.useLayoutEffect(()=>{const f=()=>{i()};return he.subscribe(xe.SPEED_NOTIFY,f),()=>he.unsubscribe(xe.SPEED_NOTIFY,f)},[i]);const c=u.exports.useMemo(()=>l===0,[l]),h=u.exports.useMemo(()=>Object.keys(Ae).find(f=>l<=Ae[f]),[l]),p=c?void 0:h;return e.createElement("div",{className:w("proxy-item",{"proxy-error":c},o)},e.createElement("span",{className:"proxy-type",style:{backgroundColor:p}},t.type),e.createElement("p",{className:"proxy-name"},t.name),e.createElement("p",{className:"proxy-delay"},l===0?"-":`${l}ms`))}function sn(n){const{markProxySelected:t}=se(),[o]=j(It),{data:a}=re(),r=$(),{config:s}=n;async function i(h){if(await r.changeProxySelected(n.config.name,h),t(n.config.name,h),a.breakConnections){const p=[],f=await r.getConnections();for(const m of f.data.connections)m.chains.includes(n.config.name)&&p.push(m.id);await Promise.all(p.map(m=>r.closeConnection(m)))}}const l=u.exports.useMemo(()=>{var p;const h=new Set;for(const f of s.all){const m=(p=o.get(f))==null?void 0:p.history;(m==null?void 0:m.length)&&m.slice(-1)[0].delay===0&&h.add(f)}return h},[s.all,o]),c=s.type==="Selector";return e.createElement("div",{className:"proxy-group"},e.createElement("div",{className:"flex h-10 mt-4 w-full items-center justify-between md:h-15 md:mt-0 md:w-auto "},e.createElement("span",{className:"h-6 px-5 w-35 overflow-hidden overflow-ellipsis whitespace-nowrap md:w-30"},s.name),e.createElement(ae,{className:"mr-5 md:mr-0"},s.type)),e.createElement("div",{className:"flex-1 py-2 md:py-4"},e.createElement(Ht,{className:"ml-5 md:ml-8",data:s.all,onClick:i,errSet:l,select:s.now,canClick:c,rowHeight:30})))}function ln(n){const{update:t}=Ye(),{translation:o,lang:a}=P(),r=$(),{provider:s}=n,{t:i}=o("Proxies"),{visible:l,hide:c,show:h}=Pe();function p(){h(),r.healthCheckProvider(s.name).then(async()=>await t()).finally(()=>c())}function f(){h(),r.updateProvider(s.name).then(async()=>await t()).finally(()=>c())}const m=u.exports.useMemo(()=>s.proxies.slice().sort((x,y)=>-1*ge(x,y)),[s.proxies]);return e.createElement(H,{className:"proxy-provider"},e.createElement(Ze,{visible:l}),e.createElement("div",{className:"flex flex-col justify-between md:flex-row md:items-center "},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"mr-6"},s.name),e.createElement(ae,null,s.vehicleType)),e.createElement("div",{className:"flex pt-3 items-center md:pt-0"},s.updatedAt&&e.createElement("span",{className:"text-sm"},`${i("providerUpdateTime")}: ${Se(new Date(s.updatedAt),a)}`),e.createElement(R,{className:"cursor-pointer text-red pl-5",type:"healthcheck",size:18,onClick:p}),e.createElement(R,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:f}))),e.createElement("ul",{className:"proxies-list"},m.map(x=>e.createElement("li",{key:x.name},e.createElement(qe,{className:"proxy-provider-item",config:x})))))}const cn={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function ge(n,t){const o=n.history.length>0?n.history.slice(-1)[0].delay:0;return((t.history.length>0?t.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(o||Number.MAX_SAFE_INTEGER)}function dn(){const{groups:n,global:t}=se(),{data:o,set:a}=re(),{general:r}=Ne(),{translation:s}=P(),{t:i}=s("Proxies"),l=u.exports.useMemo(()=>r.mode==="global"?[t,...n]:n,[r,n,t]);return e.createElement(e.Fragment,null,l.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(_,{title:i("groupTitle")},e.createElement(Je,{className:"cursor-pointer text-sm text-shadow-primary text-primary-600",checked:o.breakConnections,onChange:c=>a("breakConnections",c)},i("breakConnectionsText"))),e.createElement(H,{className:"my-2.5 p-0 md:my-4"},e.createElement("ul",{className:"list-none divide-y divide-gray-300"},l.map(c=>e.createElement("li",{key:c.name},e.createElement(sn,{config:c})))))))}function un(){const{providers:n}=Ye(),{translation:t}=P(),{t:o}=t("Proxies");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(_,{title:o("providerTitle")}),e.createElement("ul",{className:"list-none"},n.map(a=>e.createElement("li",{className:"my-2.5 md:my-4",key:a.name},e.createElement(ln,{provider:a}))))))}function mn(){const{proxies:n}=se(),{translation:t}=P(),{t:o}=t("Proxies");function a(){he.notifySpeedTest()}const{current:r,next:s}=_t([1,2,0]),i=u.exports.useMemo(()=>{switch(r){case 2:return n.slice().sort((c,h)=>ge(c,h));case 1:return n.slice().sort((c,h)=>-1*ge(c,h));default:return n.slice()}},[r,n]),l=s;return e.createElement(e.Fragment,null,i.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(_,{title:o("title")},e.createElement(R,{className:"ml-3",type:cn[r],onClick:l,size:20}),e.createElement(R,{className:"ml-3",type:"speed",size:20}),e.createElement("span",{className:"proxies-speed-test",onClick:a},o("speedTestText"))),e.createElement("ul",{className:"proxies-list"},i.map(c=>e.createElement("li",{key:c.name},e.createElement(qe,{config:c}))))))}function pn(){return e.createElement("div",{className:"page"},e.createElement(dn,null),e.createElement(un,null),e.createElement(mn,null))}function fn(n){const{update:t}=Oe(),{translation:o,lang:a}=P(),r=$(),{provider:s}=n,{t:i}=o("Rules"),{visible:l,hide:c,show:h}=Pe();function p(){h(),r.updateRuleProvider(s.name).then(async()=>await t()).finally(()=>c())}const f=w("rule-provider-icon",{"rule-provider-loading":l});return e.createElement("div",{className:"rule-provider"},e.createElement("div",{className:"rule-provider-header"},e.createElement("div",{className:"rule-provider-header-part"},e.createElement("span",{className:"rule-provider-name"},s.name),e.createElement(ae,null,s.vehicleType),e.createElement(ae,{className:"rule-provider-behavior"},s.behavior),e.createElement("span",{className:"rule-provider-update"},`${i("ruleCount")}: ${s.ruleCount}`)),e.createElement("div",{className:"rule-provider-header-part"},s.updatedAt&&e.createElement("span",{className:"rule-provider-update"},`${i("providerUpdateTime")}: ${Se(new Date(s.updatedAt),a)}`),e.createElement(R,{className:f,type:"update",size:18,onClick:p}))))}function xn(){const{providers:n}=Oe(),{translation:t}=P(),{t:o}=t("Rules");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(_,{title:o("providerTitle")}),e.createElement(H,{className:"divide-y rounded shadow-primary mt-4 p-0"},n.map(a=>e.createElement(fn,{key:a.name,provider:a})))))}function hn(){const{rules:n,update:t}=Bt(),{translation:o}=P(),{t:a}=o("Rules");X("rules",t);function r({index:s,style:i}){const l=n[s];return e.createElement("li",{className:"rule-item",style:i},e.createElement("div",{className:"flex py-1"},e.createElement("div",{className:"text-center w-40 rule-type"},l.type),e.createElement("div",{className:"flex-1 text-center payload"},l.payload),e.createElement("div",{className:"text-center w-40 rule-proxy"},l.proxy)))}return e.createElement("div",{className:"page"},e.createElement(xn,null),e.createElement(_,{className:"not-first:mt-7.5",title:a("title")}),e.createElement(H,{className:"flex flex-col flex-1 mt-2.5 p-0 md:mt-4 focus:outline-none"},e.createElement(pt,{className:"min-h-120"},({height:s,width:i})=>e.createElement(ft,{height:s,width:i,itemCount:n.length,itemSize:50},r))))}const gn=[{label:"\u4E2D\u6587",value:"zh_CN"},{label:"English",value:"en_US"}];function bn(){var V,K,te;const{premium:n}=Ue(),{data:t,update:o}=We(),{general:a,update:r}=Ne(),s=ve(Ce),i=ee(),{translation:l,setLang:c,lang:h}=P(),{t:p}=l("Settings"),f=$(),[m,x]=oe({socks5ProxyPort:7891,httpProxyPort:7890,mixedProxyPort:0});u.exports.useEffect(()=>{var E,d,k;x("socks5ProxyPort",(E=a==null?void 0:a.socksPort)!=null?E:0),x("httpProxyPort",(d=a==null?void 0:a.port)!=null?d:0),x("mixedProxyPort",(k=a==null?void 0:a.mixedPort)!=null?k:0)},[a,x]);async function y(E){await f.updateConfig({mode:E}),await r()}async function v(E){await(C==null?void 0:C.setStartAtLogin(E)),await o()}async function F(E){await(C==null?void 0:C.setSystemProxy(E)),await o()}function S(E){c(E)}async function z(){await f.updateConfig({port:m.httpProxyPort}),await r()}async function N(){await f.updateConfig({"socks-port":m.socks5ProxyPort}),await r()}async function D(){await f.updateConfig({"mixed-port":m.mixedProxyPort}),await r()}async function J(E){await f.updateConfig({"allow-lan":E}),await r()}const{hostname:U,port:W}=i,{allowLan:O,mode:ie}=a,le=(V=t==null?void 0:t.startAtLogin)!=null?V:!1,I=(K=t==null?void 0:t.systemProxy)!=null?K:!1,A=(te=t==null?void 0:t.isClashX)!=null?te:!1,ce=u.exports.useMemo(()=>{const E=[{label:p("values.global"),value:"Global"},{label:p("values.rules"),value:"Rule"},{label:p("values.direct"),value:"Direct"}];return n&&E.push({label:p("values.script"),value:"Script"}),E},[p,n]);return e.createElement("div",{className:"page"},e.createElement(_,{title:p("title")}),e.createElement(H,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.startAtLogin")),e.createElement(ue,{disabled:!(t!=null&&t.isClashX),checked:le,onChange:v})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.language")),e.createElement(Fe,{options:gn,value:h,onSelect:E=>S(E)}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.setAsSystemProxy")),e.createElement(ue,{disabled:!A,checked:I,onChange:F})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.allowConnectFromLan")),e.createElement(ue,{checked:O,onChange:J})))),e.createElement(H,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.proxyMode")),e.createElement(Fe,{options:ce,value:xt(ie),onSelect:y})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.socks5ProxyPort")),e.createElement(Z,{className:"w-28",disabled:A,value:m.socks5ProxyPort,onChange:E=>x("socks5ProxyPort",+E),onBlur:N}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.httpProxyPort")),e.createElement(Z,{className:"w-28",disabled:A,value:m.httpProxyPort,onChange:E=>x("httpProxyPort",+E),onBlur:z})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.mixedProxyPort")),e.createElement(Z,{className:"w-28",disabled:A,value:m.mixedProxyPort,onChange:E=>x("mixedProxyPort",+E),onBlur:D}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},p("labels.externalController")),e.createElement("span",{className:w({"modify-btn":!A},"external-controller"),onClick:()=>!A&&s(!1)},`${U}:${W}`)),e.createElement("div",{className:"px-8 w-1/2"}))))}var wn="./assets/logo.b453e72f.png";function yn(n){const{routes:t}=n,{translation:o}=P(),{version:a,premium:r}=Ue(),{data:s}=We(),{t:i}=o("SideBar"),l=ye(),c=t.map(({path:h,name:p,noMobile:f})=>e.createElement("li",{className:w("item",{"no-mobile":f}),key:p},e.createElement(ht,{to:{pathname:h,search:l.search},className:({isActive:m})=>w({active:m})},i(p))));return e.createElement("div",{className:"sidebar"},e.createElement("img",{src:wn,alt:"logo",className:"sidebar-logo"}),e.createElement("ul",{className:"sidebar-menu"},c),e.createElement("div",{className:"sidebar-version"},e.createElement("span",{className:"sidebar-version-label"},"Clash",(s==null?void 0:s.isClashX)&&"X"," ",i("Version")),e.createElement("span",{className:"sidebar-version-text"},a),r&&e.createElement("span",{className:"sidebar-version-label"},"Premium")))}function vn(){Ge();const n=ye(),t=[{path:"/proxies",name:"Proxies",element:e.createElement(pn,null)},{path:"/logs",name:"Logs",element:e.createElement(an,null)},{path:"/rules",name:"Rules",element:e.createElement(hn,null),noMobile:!0},{path:"/connections",name:"Connections",element:e.createElement(en,null),noMobile:!0},{path:"/settings",name:"Settings",element:e.createElement(bn,null)}],o=e.createElement("div",{className:w("app",{"not-clashx":!q()})},e.createElement(yn,{routes:t}),e.createElement("div",{className:"page-container"},e.createElement(gt,null)),e.createElement(tn,null));return e.createElement(bt,null,e.createElement(de,{path:"/",element:o},e.createElement(de,{path:"/",element:e.createElement(wt,{to:{pathname:"/proxies",search:n.search},replace:!0})}),t.map(a=>e.createElement(de,{path:a.path,key:a.path,element:a.element}))))}function Le(){const n=document.getElementById("root"),t=e.createElement(u.exports.StrictMode,null,e.createElement(vt,null,e.createElement(u.exports.Suspense,{fallback:e.createElement(Ze,{visible:!0})},e.createElement(vn,null))));yt(n).render(t)}q()?Ct(()=>Le()):Le();
